pm.test("Login OK", () => {
    pm.response.to.have.status(200);
});

const jsonData = pm.response.json();
pm.environment.set("accessToken", jsonData.refreshToken);

pm.test("Token generated", () => {
    pm.expect(jsonData.refreshToken).to.not.be.empty;
});

const schema = {
    "definitions": {
        "Welcome": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "accessToken": {
                    "type": "string"
                },
                "refreshToken": {
                    "type": "string"
                },
                "id": {
                    "type": "integer"
                },
                "username": {
                    "type": "string"
                },
                "email": {
                    "type": "string"
                },
                "firstName": {
                    "type": "string"
                },
                "lastName": {
                    "type": "string"
                },
                "gender": {
                    "type": "string"
                },
                "image": {
                    "type": "string",
                    "format": "uri",
                    "qt-uri-protocols": [
                        "https"
                    ]
                }
            },
            "required": [
                "accessToken",
                "email",
                "firstName",
                "gender",
                "id",
                "image",
                "lastName",
                "refreshToken",
                "username"
            ],
            "title": "Welcome"
        }
    }
}

pm.test("Vérifier Schema de réponse", () => {
  pm.response.to.have.jsonSchema(schema);
});